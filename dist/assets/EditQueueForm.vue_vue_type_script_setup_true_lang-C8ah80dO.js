import{d as L,a as Q,u as E}from"./index-npWqo0Ou.js";import{d as h,z as W,C as H,q as C,f as b,b as D,c as R,h as r,w as f,e as n,t as g,u as y,D as F,i as P,j as G,F as J,_ as K,r as B,m as T,o as X,g as Y}from"./index-Bcr3mXlA.js";import{u as A}from"./queues-ahqpviki.js";import{u as Z}from"./useForm-fy7gsO6_.js";import{u as ee}from"./users-DylJnNym.js";import{u as le}from"./services-T7CBbn_K.js";import{v as O}from"./utils-DvwhG7-T.js";const ae={class:"max-w-[120px] ellipsis"},te={class:"max-w-[120px] ellipsis"},se={class:"max-w-[120px] ellipsis"},oe={class:"max-w-[120px] ellipsis"},ne={class:"max-w-[120px] ellipsis"},re={class:"max-w-[120px] ellipsis"},ue={class:"max-w-[120px] ellipsis"},ie={class:"flex gap-2 justify-end"},de={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},me={key:0,class:"flex"},pe=h({__name:"QueuesTable",props:{queues:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,default:null}},emits:["edit-queue","delete-queue","update:sortBy","update:sortingOrder"],setup($,{emit:i}){let w;const _=W(),v=L(((w=_.currentUser)==null?void 0:w.role)!=="client"?[{label:"Service",key:"service",sortable:!0},{label:"Room",key:"room",sortable:!0},{label:"Client",key:"client",sortable:!0},{label:"Number",key:"number",sortable:!0},{label:"Time",key:"time",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Created At",key:"created",sortable:!0},{label:" ",key:"actions",align:"right"}]:[{label:"Service",key:"service",sortable:!0},{label:"Room",key:"room",sortable:!0},{label:"Number",key:"number",sortable:!0},{label:"Time",key:"time",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:" ",key:"actions",align:"right"}]),d=$,u=i,e=H(d,"queues"),k=Q(d,"sortBy",u),V=Q(d,"sortingOrder",u),S=C(()=>Math.ceil(d.pagination.total/d.pagination.perPage)),{confirm:p}=E(),m=async s=>{await p({title:"Delete queue ticket",message:`Are you sure you want to delete Ticket ${s.number} for ${s.service.name}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&u("delete-queue",s)};return(s,o)=>{const x=b("VaButton"),U=b("VaDataTable"),t=b("VaSelect"),a=b("VaPagination");return D(),R(J,null,[r(U,{"sort-by":y(k),"onUpdate:sortBy":o[0]||(o[0]=l=>F(k)?k.value=l:null),"sorting-order":y(V),"onUpdate:sortingOrder":o[1]||(o[1]=l=>F(V)?V.value=l:null),columns:y(v),items:e.value,loading:s.$props.loading},{"cell(service)":f(({rowData:l})=>[n("div",ae,g(l.service.name),1)]),"cell(room)":f(({rowData:l})=>[n("div",te,g(l.service.room),1)]),"cell(client)":f(({rowData:l})=>{let q;return[n("div",se,g(((q=l.client.profile)==null?void 0:q.fullname)||l.client.username),1)]}),"cell(number)":f(({rowData:l})=>[n("div",oe,g(l.number),1)]),"cell(time)":f(({rowData:l})=>[n("div",ne,g(l.time),1)]),"cell(status)":f(({rowData:l})=>[n("div",re,g(l.step),1)]),"cell(created)":f(({rowData:l})=>[n("div",ue,g(l.created_at),1)]),"cell(actions)":f(({rowData:l})=>[n("div",ie,[r(x,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit queue",onClick:q=>s.$emit("edit-queue",l)},null,8,["onClick"]),r(x,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete queue",onClick:q=>m(l)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),n("div",de,[n("div",null,[n("b",null,g(s.$props.pagination.total)+" results.",1),o[6]||(o[6]=P(" Results per page ")),r(t,{modelValue:s.$props.pagination.perPage,"onUpdate:modelValue":o[2]||(o[2]=l=>s.$props.pagination.perPage=l),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),S.value>1?(D(),R("div",me,[r(x,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:s.$props.pagination.page===1,onClick:o[3]||(o[3]=l=>s.$props.pagination.page--)},null,8,["disabled"]),r(x,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:s.$props.pagination.page===S.value,onClick:o[4]||(o[4]=l=>s.$props.pagination.page++)},null,8,["disabled"]),r(a,{modelValue:s.$props.pagination.page,"onUpdate:modelValue":o[5]||(o[5]=l=>s.$props.pagination.page=l),"buttons-preset":"secondary",pages:S.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):G("",!0)])],64)}}}),Be=K(pe,[["__scopeId","data-v-91af82e8"]]),ce=()=>B({page:1,perPage:10,total:0}),ve=()=>B({sortBy:"number",sortingOrder:null}),fe=()=>B({isActive:!0,search:""}),Oe=$=>{const i=B(!1),_=B(),v=A(),{filters:d=fe(),sorting:u=ve(),pagination:e=ce(),lazy:k=!1}=$||{},V=async()=>{i.value=!0;try{await v.getAll({filters:y(d),sorting:y(u),pagination:y(e)}),e.value=v.pagination}finally{i.value=!1}};T(d,()=>{e.value.page=1,V()},{deep:!0}),k||V();const S=C(()=>{const p=(w,s)=>w[s],m=v.items.slice((e.value.page-1)*e.value.perPage,e.value.page*e.value.perPage);return u.value.sortBy&&u.value.sortingOrder&&m.sort((w,s)=>{const o=p(w,u.value.sortBy),x=p(s,u.value.sortBy);return o>x?u.value.sortingOrder==="asc"?1:-1:o<x?u.value.sortingOrder==="asc"?-1:1:0}),m});return{error:_,isLoading:i,filters:d,sorting:u,pagination:e,queues:S,fetch:V,async add(p){i.value=!0;try{return await v.add(p)}catch(m){_.value=m}finally{i.value=!1}},async update(p){i.value=!0;try{return await v.update(p)}catch(m){_.value=m}finally{i.value=!1}},async remove(p){i.value=!0;try{return await v.remove(p)}catch(m){_.value=m}finally{i.value=!1}}}},ge={class:"flex gap-4 flex-col sm:flex-row w-full"},be={class:"flex gap-4 flex-col sm:flex-row w-full"},ye={class:"flex gap-4 flex-col sm:flex-row w-full"},Ve={class:"flex gap-4 flex-col sm:flex-row w-full"},we={class:"flex gap-2 justify-end w-full"},Te=h({__name:"EditQueueForm",props:{queue:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup($,{expose:i,emit:_}){const v=$,d={date:new Date().toISOString().split("T")[0],number:null,time:null,step:0,client_id:null,comment:"",service_id:null},u={0:"Reserved",1:"Waiting",2:"Meeting",3:"Finished"},e=B({...d});T(()=>v.queue,t=>{t?e.value={...t}:e.value={...d}},{immediate:!0});const k=C(()=>Object.keys(e.value).some(t=>{let a;return e.value[t]!==((a=v.queue??d)==null?void 0:a[t])}));i({isFormHasUnsavedChanges:k}),T(()=>[e.value.service_id,e.value.date],([t,a])=>{t&&a&&(e.value.number=null,s.getAvailableNumbers(a,t))}),T(()=>e.value.number,t=>{if(t){const a=s.numbers.find(l=>l.queue_number===t);a&&(e.value.time=a.time)}});const V=Z("add-queue-form"),S=_,p=()=>{V.validate()&&S("save",e.value)},m=ee(),w=le(),s=A();X(async()=>{await m.getClientUsers(),await w.getAll({})});const o=C(()=>m.clients.map(t=>{let a;return{text:((a=t.profile)==null?void 0:a.fullname)||t.username,value:t.id}})),x=C(()=>w.items.map(t=>({text:t.name,value:t.id}))),U=C(()=>s.numbers.map(t=>({text:`${t.time} - ${t.queue_number} ${t.possible?"":" - Reserved"}`,value:t.queue_number,disabled:!t.possible})));return(t,a)=>{const l=b("VaSelect"),q=b("VaDateInput"),j=b("VaSlider"),M=b("VaTextarea"),N=b("VaButton"),z=b("VaForm");return D(),Y(z,{ref:"add-queue-form",class:"flex flex-col gap-4 w-full"},{default:f(({isValid:I})=>[n("div",ge,[r(l,{placeholder:"Select a client",modelValue:e.value.client_id,"onUpdate:modelValue":a[0]||(a[0]=c=>e.value.client_id=c),label:"Client",class:"w-full sm:w-1/2",options:o.value,rules:[y(O).required],name:"client_id","track-by":"value","value-by":"value"},null,8,["modelValue","options","rules"]),r(l,{modelValue:e.value.service_id,"onUpdate:modelValue":a[1]||(a[1]=c=>e.value.service_id=c),options:x.value,label:"Service",rules:[y(O).required],placeholder:"Select a service",class:"w-full sm:w-1/2","track-by":"value","value-by":"value"},null,8,["modelValue","options","rules"])]),n("div",be,[r(q,{modelValue:e.value.date,"onUpdate:modelValue":a[2]||(a[2]=c=>e.value.date=c),label:"Date",class:"w-full sm:w-1/2",rules:[y(O).required]},null,8,["modelValue","rules"]),r(l,{placeholder:"Select a time",modelValue:e.value.number,"onUpdate:modelValue":a[3]||(a[3]=c=>e.value.number=c),label:"Time & Number",class:"w-full sm:w-1/2",options:U.value,rules:[y(O).required],name:"number","track-by":"value","value-by":"value"},null,8,["modelValue","options","rules"])]),n("div",ye,[r(j,{label:"Queue Status",modelValue:e.value.step,"onUpdate:modelValue":a[4]||(a[4]=c=>e.value.step=c),min:0,max:2,step:1,pins:"",class:"w-full"},null,8,["modelValue"]),n("p",null,g(u[e.value.step]),1)]),n("div",Ve,[r(M,{placeholder:"Comment to service admin",label:"Comment",modelValue:e.value.comment,"onUpdate:modelValue":a[5]||(a[5]=c=>e.value.comment=c),class:"w-full"},null,8,["modelValue"])]),n("div",we,[r(N,{preset:"secondary",color:"secondary",onClick:a[6]||(a[6]=c=>t.$emit("close"))},{default:f(()=>a[7]||(a[7]=[P("Cancel")])),_:1}),r(N,{disabled:!I,onClick:p},{default:f(()=>[P(g($.saveButtonLabel),1)]),_:2},1032,["disabled"])])]),_:1},512)}}});export{Be as Q,Te as _,Oe as u};
//# sourceMappingURL=EditQueueForm.vue_vue_type_script_setup_true_lang-C8ah80dO.js.map

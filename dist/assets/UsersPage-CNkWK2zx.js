import{a as N,u as I,d as Q}from"./index-npWqo0Ou.js";import{d as h,C as X,q as R,f as c,b as z,c as P,h as s,w as y,e as V,t as O,u as n,D as q,i as T,j as D,F as L,_ as Y,g as E,r as $,m as M,B as Z,k as ee,l as le}from"./index-Bcr3mXlA.js";import{u as ae}from"./useForm-fy7gsO6_.js";import{v as S}from"./utils-DvwhG7-T.js";import{u as te}from"./users-DylJnNym.js";import{v as se}from"./v4-Ch9TGLTe.js";const oe={class:"max-w-[120px] ellipsis"},ne={class:"ellipsis max-w-[230px]"},re={class:"max-w-[120px] ellipsis"},ue={class:"flex gap-2 justify-end"},ie={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},de={key:0,class:"flex"},me=h({__name:"UsersTable",props:{users:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,default:null}},emits:["edit-user","delete-user","update:sortBy","update:sortingOrder"],setup(b,{emit:d}){const x=Q([{label:"Full Name",key:"fullname",sortable:!0},{label:"Email",key:"email",sortable:!0},{label:"Username",key:"username",sortable:!0},{label:"Role",key:"role",sortable:!0},{label:"Gender",key:"gender",sortable:!0},{label:" ",key:"actions",align:"right"}]),r=b,o=d,l=X(r,"users"),u=N(r,"sortBy",o),v=N(r,"sortingOrder",o),C={admin:"danger",client:"background-element",service_admin:"warning"},i={male:"dark",female:"purple"},m=R(()=>Math.ceil(r.pagination.total/r.pagination.perPage)),{confirm:B}=I(),w=async a=>{await B({title:"Delete user",message:`Are you sure you want to delete ${a.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&o("delete-user",a)};return(a,e)=>{const k=c("VaBadge"),A=c("VaButton"),j=c("VaDataTable"),g=c("VaSelect"),p=c("VaPagination");return z(),P(L,null,[s(j,{"sort-by":n(u),"onUpdate:sortBy":e[0]||(e[0]=t=>q(u)?u.value=t:null),"sorting-order":n(v),"onUpdate:sortingOrder":e[1]||(e[1]=t=>q(v)?v.value=t:null),columns:n(x),items:l.value,loading:a.$props.loading},{"cell(fullname)":y(({rowData:t})=>{let U;return[V("div",oe,O(((U=t==null?void 0:t.profile)==null?void 0:U.fullname)||""),1)]}),"cell(email)":y(({rowData:t})=>[V("div",ne,O(t.email),1)]),"cell(username)":y(({rowData:t})=>[V("div",re,O(t.username),1)]),"cell(role)":y(({rowData:t})=>[s(k,{text:t.role,color:C[t.role]},null,8,["text","color"])]),"cell(gender)":y(({rowData:t})=>{let U,F;return[s(k,{text:(U=t.profile)==null?void 0:U.gender,color:i[(F=t.profile)==null?void 0:F.gender]},null,8,["text","color"])]}),"cell(actions)":y(({rowData:t})=>[V("div",ue,[s(A,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit user",onClick:U=>a.$emit("edit-user",t)},null,8,["onClick"]),s(A,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete user",onClick:U=>w(t)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),V("div",ie,[V("div",null,[V("b",null,O(a.$props.pagination.total)+" results.",1),e[6]||(e[6]=T(" Results per page ")),s(g,{modelValue:a.$props.pagination.perPage,"onUpdate:modelValue":e[2]||(e[2]=t=>a.$props.pagination.perPage=t),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),m.value>1?(z(),P("div",de,[s(A,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:a.$props.pagination.page===1,onClick:e[3]||(e[3]=t=>a.$props.pagination.page--)},null,8,["disabled"]),s(A,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:a.$props.pagination.page===m.value,onClick:e[4]||(e[4]=t=>a.$props.pagination.page++)},null,8,["disabled"]),s(p,{modelValue:a.$props.pagination.page,"onUpdate:modelValue":e[5]||(e[5]=t=>a.$props.pagination.page=t),"buttons-preset":"secondary",pages:m.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):D("",!0)])],64)}}}),ce=Y(me,[["__scopeId","data-v-67c8c4fe"]]),pe=h({__name:"UserAvatar",props:{user:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(b){const d=o=>{const l=["primary","#FFD43A","#ADFF00","#262824","danger"],u=o.charCodeAt(0)%l.length;return l[u]},x=o=>o?o.startsWith("http")||o.startsWith("blob:"):!1,r=o=>{try{const[l,u]=o.split(" ");return`${l[0]}${u[0]}`}catch{return o[0]}};return(o,l)=>{const u=c("VaAvatar");return z(),E(u,{size:b.size,src:x(b.user.avatar)?b.user.avatar:"","fallback-text":r(b.user.fullname),color:d(b.user.fullname)},null,8,["size","src","fallback-text","color"])}}}),fe={class:"self-stretch flex-col justify-start items-start gap-4 flex"},ve={class:"flex gap-4 flex-col sm:flex-row w-full"},ge={class:"flex gap-4 flex-col sm:flex-row w-full"},Ve={class:"flex gap-4 w-full"},ye={class:"w-1/2"},be={class:"flex items-center w-1/2 mt-4"},xe={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},we=h({__name:"EditUserForm",props:{user:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(b,{expose:d,emit:x}){const r=b,o={avatar:"",fullname:"",role:"user",username:"",notes:"",email:"",active:!0,projects:[]},l=$({...o}),u=R(()=>Object.keys(l.value).some(a=>{let e;return a==="avatar"||a==="projects"?!1:l.value[a]!==((e=r.user??o)==null?void 0:e[a])}));d({isFormHasUnsavedChanges:u}),M([()=>r.user,projects],()=>{r.user&&(l.value={...r.user})},{immediate:!0});const v=$(),C=a=>URL.createObjectURL(a);M(v,a=>{l.value.avatar=a?C(a):""});const i=ae("add-user-form"),m=x,B=()=>{i.validate()&&m("save",l.value)},w=[{text:"Admin",value:"admin"},{text:"User",value:"user"},{text:"Owner",value:"owner"}];return(a,e)=>{const k=c("VaButton"),A=c("VaFileUpload"),j=c("VaInput"),g=c("VaSelect"),p=c("VaCheckbox"),t=c("VaTextarea"),U=c("VaForm");return z(),E(U,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:y(({isValid:F})=>[s(A,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=f=>v.value=f),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:y(()=>[s(pe,{user:l.value,size:"large"},null,8,["user"]),s(k,{preset:"primary",size:"small"},{default:y(()=>e[10]||(e[10]=[T("Add image")])),_:1}),v.value?(z(),E(k,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:e[0]||(e[0]=Z(f=>v.value=void 0,["stop"]))})):D("",!0)]),_:1},8,["modelValue"]),V("div",fe,[V("div",ve,[s(j,{modelValue:l.value.fullname,"onUpdate:modelValue":e[2]||(e[2]=f=>l.value.fullname=f),label:"Full name",class:"w-full sm:w-1/2",rules:[n(S).required],name:"fullName"},null,8,["modelValue","rules"]),s(j,{modelValue:l.value.username,"onUpdate:modelValue":e[3]||(e[3]=f=>l.value.username=f),label:"Username",class:"w-full sm:w-1/2",rules:[n(S).required],name:"username"},null,8,["modelValue","rules"])]),V("div",ge,[s(j,{modelValue:l.value.email,"onUpdate:modelValue":e[4]||(e[4]=f=>l.value.email=f),label:"Email",class:"w-full sm:w-1/2",rules:[n(S).required,n(S).email],name:"email"},null,8,["modelValue","rules"]),s(g,{modelValue:l.value.projects,"onUpdate:modelValue":e[5]||(e[5]=f=>l.value.projects=f),label:"Projects",class:"w-full sm:w-1/2",options:a.projects,"value-by":"id","text-by":"project_name",rules:[n(S).required],name:"projects",multiple:"","max-visible-options":2},null,8,["modelValue","options","rules"])]),V("div",Ve,[V("div",ye,[s(g,{modelValue:l.value.role,"onUpdate:modelValue":e[6]||(e[6]=f=>l.value.role=f),label:"Role",class:"w-full",options:w,rules:[n(S).required],name:"role","value-by":"value"},null,8,["modelValue","rules"])]),V("div",be,[s(p,{modelValue:l.value.active,"onUpdate:modelValue":e[7]||(e[7]=f=>l.value.active=f),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),s(t,{modelValue:l.value.notes,"onUpdate:modelValue":e[8]||(e[8]=f=>l.value.notes=f),label:"Notes",class:"w-full",name:"notes"},null,8,["modelValue"]),V("div",xe,[s(k,{preset:"secondary",color:"secondary",onClick:e[9]||(e[9]=f=>a.$emit("close"))},{default:y(()=>e[11]||(e[11]=[T("Cancel")])),_:1}),s(k,{disabled:!F,onClick:B},{default:y(()=>[T(O(b.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]),_:1},512)}}}),Ue=()=>$({page:1,perPage:10,total:0}),_e=()=>$({sortBy:"fullname",sortingOrder:null}),ke=()=>$({isActive:!0,search:""}),$e=b=>{const d=$(!1),x=$(),r=te(),{filters:o=ke(),sorting:l=_e(),pagination:u=Ue()}={},v=async()=>{d.value=!0;try{await r.getAll({filters:n(o),sorting:n(l),pagination:n(u)}),u.value=r.pagination}finally{d.value=!1}};M(o,()=>{u.value.page=1,v()},{deep:!0}),v();const C=R(()=>{const i=(B,w)=>B[w],m=r.items.slice((u.value.page-1)*u.value.perPage,u.value.page*u.value.perPage);return l.value.sortBy&&l.value.sortingOrder&&m.sort((B,w)=>{const a=i(B,l.value.sortBy),e=i(w,l.value.sortBy);return a>e?l.value.sortingOrder==="asc"?1:-1:a<e?l.value.sortingOrder==="asc"?-1:1:0}),m});return{error:x,isLoading:d,filters:o,sorting:l,pagination:u,users:C,fetch:v,async add(i){d.value=!0;try{return await r.add(i)}catch(m){x.value=m}finally{d.value=!1}},async update(i){d.value=!0;try{return await r.update(i)}catch(m){x.value=m}finally{d.value=!1}},async remove(i){d.value=!0;try{return await r.remove(i)}catch(m){x.value=m}finally{d.value=!1}},async uploadAvatar(i){const m=new FormData;return m.append("avatar",i),m.append("id",se()),r.uploadAvatar(m)}}},Ce={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Be={class:"flex flex-col md:flex-row gap-2 justify-start"},Ae={class:"va-h5"},he=h({__name:"UsersPage",setup(b){const d=$(!1),{users:x,isLoading:r,filters:o,sorting:l,pagination:u,error:v,...C}=$e(),i=$(null),m=g=>{i.value=g,d.value=!0},B=()=>{i.value=null,d.value=!0},{init:w}=ee();le(()=>{v.value&&w({message:v.value.message,color:"danger"})});const a=async g=>{i.value?(await C.update(g),v.value||w({message:`${g.fullname} has been updated`,color:"success"})):(await C.add(g),v.value||w({message:`${g.fullname} has been created`,color:"success"}))},e=async g=>{await C.remove(g),w({message:`${g.fullname} has been deleted`,color:"success"})},k=$(),{confirm:A}=I(),j=async g=>{k.value.isFormHasUnsavedChanges?await A({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&g():g()};return(g,p)=>{const t=c("VaButtonToggle"),U=c("VaIcon"),F=c("VaInput"),f=c("VaButton"),W=c("VaCardContent"),H=c("VaCard"),G=c("VaModal");return z(),P(L,null,[p[6]||(p[6]=V("h1",{class:"page-title"},"Users",-1)),s(H,null,{default:y(()=>[s(W,null,{default:y(()=>[V("div",Ce,[V("div",Be,[s(t,{modelValue:n(o).isActive,"onUpdate:modelValue":p[0]||(p[0]=_=>n(o).isActive=_),color:"background-element","border-color":"background-element",options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},null,8,["modelValue"]),s(F,{modelValue:n(o).search,"onUpdate:modelValue":p[1]||(p[1]=_=>n(o).search=_),placeholder:"Search"},{prependInner:y(()=>[s(U,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])]),s(f,{onClick:B},{default:y(()=>p[5]||(p[5]=[T("Add User")])),_:1})]),s(ce,{"sort-by":n(l).sortBy,"onUpdate:sortBy":p[2]||(p[2]=_=>n(l).sortBy=_),"sorting-order":n(l).sortingOrder,"onUpdate:sortingOrder":p[3]||(p[3]=_=>n(l).sortingOrder=_),users:n(x),loading:n(r),pagination:n(u),onEditUser:m,onDeleteUser:e},null,8,["sort-by","sorting-order","users","loading","pagination"])]),_:1})]),_:1}),s(G,{modelValue:d.value,"onUpdate:modelValue":p[4]||(p[4]=_=>d.value=_),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":j},{default:y(({cancel:_,ok:J})=>[V("h1",Ae,O(i.value?"Edit user":"Add user"),1),s(we,{ref_key:"editFormRef",ref:k,user:i.value,"save-button-label":i.value?"Save":"Add",onClose:_,onSave:K=>{a(K),J()}},null,8,["user","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{he as default};
//# sourceMappingURL=UsersPage-CNkWK2zx.js.map

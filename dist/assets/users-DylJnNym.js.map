{"version":3,"file":"users-DylJnNym.js","sources":["../../src/data/pages/users.ts","../../src/stores/users.ts"],"sourcesContent":["import { User } from '../../pages/users/types'\nimport api from '../../services/api'\n\nexport type Pagination = {\n  page: number\n  perPage: number\n  total: number\n}\n\nexport type Sorting = {\n  sortBy: keyof User | undefined\n  sortingOrder: 'asc' | 'desc' | null\n}\n\nexport type Filters = {\n  isActive: boolean\n  search: string\n}\n\nexport const getUsers = async (filters: Partial<Filters & Pagination & Sorting>) => {\n  const { isActive, search } = filters\n  let filteredUsers: User[] = await api.request(api.allUsers())\n\n  console.log(filteredUsers)\n\n  filteredUsers = filteredUsers.filter((user) => user.disabled === !isActive)\n\n  if (search) {\n    filteredUsers = filteredUsers.filter(\n      (user) =>\n        user.profile?.fullname.toLowerCase().includes(search.toLowerCase()) ||\n        user.username.toLowerCase().includes(search.toLowerCase()) ||\n        user.email.toLowerCase().includes(search.toLowerCase()),\n    )\n  }\n\n  const { page = 1, perPage = 10 } = filters || {}\n  return {\n    data: filteredUsers,\n    pagination: {\n      page,\n      perPage,\n      total: filteredUsers.length,\n    },\n  }\n}\n\nexport const getClients = async () => {\n  return await api.request(api.allClients(), {\n    method: \"POST\"\n  })\n}\n\nexport const addUser = async (user: User) => {\n  const headers = new Headers()\n  headers.append('Content-Type', 'application/json')\n\n  const result = await fetch(api.allUsers(), { method: 'POST', body: JSON.stringify(user), headers }).then((r) =>\n    r.json(),\n  )\n\n  if (!result.error) {\n    return result\n  }\n\n  throw new Error(result.error)\n}\n\nexport const updateUser = async (user: User) => {\n  const headers = new Headers()\n  headers.append('Content-Type', 'application/json')\n\n  const result = await fetch(api.user(user.id), { method: 'PUT', body: JSON.stringify(user), headers }).then((r) =>\n    r.json(),\n  )\n\n  if (!result.error) {\n    return result\n  }\n\n  throw new Error(result.error)\n}\n\nexport const removeUser = async (user: User) => {\n  return fetch(api.user(user.id), { method: 'DELETE' })\n}\n\nexport const uploadAvatar = async (body: FormData) => {\n  return fetch(api.avatars(), { method: 'POST', body, redirect: 'follow' }).then((r) => r.json())\n}\n","import { defineStore } from 'pinia'\nimport {\n  addUser,\n  type Filters,\n  getUsers,\n  Pagination,\n  removeUser,\n  Sorting,\n  updateUser,\n  uploadAvatar,\n  getClients,\n} from '../data/pages/users'\nimport { User } from '../pages/users/types'\n\nexport const useUsersStore = defineStore('users', {\n  state: () => {\n    return {\n      items: [] as User[],\n      clients: [] as User[],\n      pagination: { page: 1, perPage: 10, total: 0 },\n    }\n  },\n\n  actions: {\n    async getAll(options: { pagination?: Pagination; sorting?: Sorting; filters?: Partial<Filters> }) {\n      const { data, pagination } = await getUsers({\n        ...options.filters,\n        ...options.sorting,\n        ...options.pagination,\n      })\n      this.items = data\n      this.pagination = pagination\n    },\n    async getClientUsers() {\n      this.clients = await getClients()\n    },\n\n    async add(user: User) {\n      const [newUser] = await addUser(user)\n      this.items.unshift(newUser)\n      return newUser\n    },\n\n    async update(user: User) {\n      const [updatedUser] = await updateUser(user)\n      const index = this.items.findIndex(({ id }) => id === user.id)\n      this.items.splice(index, 1, updatedUser)\n      return updatedUser\n    },\n\n    async remove(user: User) {\n      const isRemoved = await removeUser(user)\n\n      if (isRemoved) {\n        const index = this.items.findIndex(({ id }) => id === user.id)\n        this.items.splice(index, 1)\n      }\n    },\n\n    async uploadAvatar(formData: FormData) {\n      return uploadAvatar(formData)\n    },\n  },\n})\n"],"names":["getUsers","filters","isActive","search","filteredUsers","api","user","_a","page","perPage","getClients","addUser","headers","result","r","updateUser","removeUser","uploadAvatar","body","useUsersStore","defineStore","options","data","pagination","newUser","updatedUser","index","id","formData"],"mappings":"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"}